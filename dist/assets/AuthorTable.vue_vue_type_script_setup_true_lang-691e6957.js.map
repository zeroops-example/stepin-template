{"version":3,"file":"AuthorTable.vue_vue_type_script_setup_true_lang-691e6957.js","sources":["../../src/pages/table/AuthorTable.vue"],"sourcesContent":["<script lang=\"ts\" setup>\n  import { getBase64 } from '@/utils/file';\n  import { FormInstance } from 'ant-design-vue';\n  import { reactive, ref } from 'vue';\n  import dayjs from 'dayjs';\n  import { Dayjs } from 'dayjs';\n  import { EditFilled } from '@ant-design/icons-vue';\n\n  const columns = [\n    {\n      title: 'AUTHOR',\n      dataIndex: 'name',\n    },\n    { title: 'FUNCTION', dataIndex: 'position' },\n    { title: 'STATUS', dataIndex: 'status' },\n    { title: 'EMPLOYED', dataIndex: 'time' },\n    { title: 'OPERATION', dataIndex: 'edit', width: 200 },\n  ];\n\n  type Author = {\n    name?: string;\n    email?: string;\n    avatar?: string;\n    department?: string;\n    jobs?: string;\n    position?: string[];\n    role?: string;\n    status?: number;\n    time?: Dayjs;\n    _edit?: boolean;\n    _isNew?: boolean;\n  };\n\n  const authors = reactive<Author[]>([\n    {\n      name: 'Li Zhi',\n      email: '1126263215@qq.com',\n      avatar: '/src/assets/avatar/face-1.jpg',\n      jobs: 'developer',\n      department: 'Technical',\n      status: 1,\n      time: dayjs(),\n    },\n    {\n      name: 'Li Zhi',\n      email: '1126263215@qq.com',\n      avatar: '/src/assets/avatar/face-2.jpg',\n      jobs: 'developer',\n      department: 'Technical',\n      status: 0,\n      time: dayjs(),\n    },\n    {\n      name: 'Li Zhi',\n      email: '1126263215@qq.com',\n      avatar: '/src/assets/avatar/face-3.jpg',\n      jobs: 'developer',\n      department: 'Technical',\n      status: 1,\n      time: dayjs(),\n    },\n    {\n      name: 'Li Zhi',\n      email: '1126263215@qq.com',\n      avatar: '/src/assets/avatar/face-4.jpg',\n      jobs: 'developer',\n      department: 'Technical',\n      status: 0,\n      time: dayjs(),\n    },\n  ]);\n\n  function addNew() {\n    showModal.value = true;\n    form._isNew = true;\n  }\n\n  const showModal = ref(false);\n\n  const newAuthor = (author?: Author) => {\n    if (!author) {\n      author = { _isNew: true };\n    }\n    author.name = undefined;\n    author.email = undefined;\n    author.avatar = undefined;\n    author.position = [];\n    author.department = undefined;\n    author.jobs = undefined;\n    author.status = 0;\n    author.time = dayjs();\n    return author;\n  };\n\n  const copyObject = (target: any, source?: any) => {\n    if (!source) {\n      return target;\n    }\n    Object.keys(target).forEach((key) => (target[key] = source[key]));\n  };\n\n  const form = reactive<Author>(newAuthor());\n\n  function reset() {\n    return newAuthor(form);\n  }\n\n  function cancel() {\n    showModal.value = false;\n    reset();\n  }\n\n  const formModel = ref<FormInstance>();\n\n  const formLoading = ref(false);\n\n  async function extractImg(file: Blob, author: Author) {\n    await getBase64(file).then((res) => {\n      author.avatar = res;\n    });\n  }\n\n  function submit() {\n    formLoading.value = true;\n    formModel.value\n      ?.validateFields()\n      .then((res: Author) => {\n        res.department = res?.position?.[0];\n        res.jobs = res?.position?.[1];\n        if (form._isNew) {\n          authors.push({ ...res });\n        } else {\n          copyObject(editRecord.value, res);\n        }\n        showModal.value = false;\n        reset();\n      })\n      .catch((e) => {\n        console.error(e);\n      })\n      .finally(() => {\n        formLoading.value = false;\n      });\n  }\n\n  const editRecord = ref<Author>();\n\n  /**\n   * 编辑\n   * @param record\n   */\n  function edit(record: Author) {\n    editRecord.value = record;\n    copyObject(form, record);\n    form.position = [form.department!, form.jobs!];\n    showModal.value = true;\n  }\n\n  type Status = 0 | 1;\n\n  const StatusDict = {\n    0: 'offline',\n    1: 'online',\n  };\n</script>\n<template>\n  <a-modal :title=\"form._isNew ? '新增作者' : '编辑作者'\" v-model:visible=\"showModal\" @ok=\"submit\" @cancel=\"cancel\">\n    <a-form ref=\"formModel\" :model=\"form\" :labelCol=\"{ span: 5 }\" :wrapperCol=\"{ span: 16 }\">\n      <a-form-item label=\"头像\" required name=\"avatar\">\n        <a-upload :show-upload-list=\"false\" :beforeUpload=\"(file: File) => extractImg(file, form)\">\n          <img class=\"h-8 p-0.5 rounded border border-dashed border-border\" v-if=\"form.avatar\" :src=\"form.avatar\" />\n          <a-button v-else type=\"dashed\">\n            <template #icon>\n              <UploadOutlined />\n            </template>\n            上传\n          </a-button>\n        </a-upload>\n      </a-form-item>\n      <a-form-item label=\"姓名\" required name=\"name\">\n        <a-input v-model:value=\"form.name\" />\n      </a-form-item>\n      <a-form-item required label=\"邮箱\" name=\"email\">\n        <a-input v-model:value=\"form.email\" />\n      </a-form-item>\n      <a-form-item required label=\"岗位\" name=\"position\">\n        <a-cascader\n          v-model:value=\"form.position\"\n          :options=\"[\n            {\n              label: 'IT部',\n              value: 'IT部',\n              children: [\n                {\n                  label: '前端开发',\n                  value: '前端开发',\n                },\n                {\n                  label: '后端开发',\n                  value: '后端开发',\n                },\n                {\n                  label: 'UI设计师',\n                  value: 'UI设计师',\n                },\n              ],\n            },\n          ]\"\n        />\n      </a-form-item>\n      <a-form-item required label=\"状态\" name=\"status\">\n        <a-select\n          style=\"width: 90px\"\n          v-model:value=\"form.status\"\n          :options=\"[\n            { label: 'offline', value: 0 },\n            { label: 'online', value: 1 },\n          ]\"\n        />\n      </a-form-item>\n      <a-form-item label=\"日期\" name=\"time\">\n        <a-date-picker v-model:value=\"form.time\" />\n      </a-form-item>\n    </a-form>\n  </a-modal>\n\n  <!-- 成员表格 -->\n  <a-table v-bind=\"$attrs\" :columns=\"columns\" :dataSource=\"authors\" :pagination=\"false\">\n    <template #title>\n      <div class=\"flex justify-between pr-4\">\n        <h4>成员表格</h4>\n        <a-button type=\"primary\" @click=\"addNew\" :loading=\"formLoading\">\n          <template #icon>\n            <PlusOutlined />\n          </template>\n          新增\n        </a-button>\n      </div>\n    </template>\n    <template #bodyCell=\"{ column, text, record }\">\n      <div class=\"flex items-stretch\" v-if=\"column.dataIndex === 'name'\">\n        <img class=\"w-12 rounded\" :src=\"record.avatar\" />\n        <div class=\"flex-col flex justify-evenly ml-2\">\n          <span class=\"text-title font-bold\">{{ text }}</span>\n          <span class=\"text-xs text-subtext\">{{ record.email }}</span>\n        </div>\n      </div>\n      <div class=\"\" v-else-if=\"column.dataIndex === 'position'\">\n        <div class=\"text-title font-bold\">\n          {{ record.jobs }}\n        </div>\n        <div class=\"text-subtext\">\n          {{ record.department }}\n        </div>\n      </div>\n      <template v-else-if=\"column.dataIndex === 'status'\">\n        <a-badge class=\"text-subtext\" :color=\"'green'\">\n          <template #text>\n            <span class=\"text-subtext\">{{ StatusDict[text as Status] }}</span>\n          </template>\n        </a-badge>\n      </template>\n      <template v-else-if=\"column.dataIndex === 'time'\">\n        {{ text?.format('YYYY-MM-DD') }}\n      </template>\n      <template v-else-if=\"column.dataIndex === 'edit'\">\n        <a-button :disabled=\"showModal\" type=\"link\" @click=\"edit(record)\">\n          <template #icon>\n            <EditFilled />\n          </template>\n          编辑\n        </a-button>\n      </template>\n      <div v-else class=\"text-subtext\">\n        {{ text }}\n      </div>\n    </template>\n  </a-table>\n</template>\n"],"names":["columns","authors","reactive","dayjs","addNew","showModal","form","ref","newAuthor","author","copyObject","target","source","key","reset","cancel","formModel","formLoading","extractImg","file","getBase64","res","submit","_a","_b","editRecord","edit","record","StatusDict"],"mappings":"i0BAQE,MAAAA,EAAA,CAAgB,CACd,MAAA,SACS,UAAA,MACI,EACb,CAAA,MAAA,WAAA,UAAA,UAAA,EAC2C,CAAA,MAAA,SAAA,UAAA,QAAA,EACJ,CAAA,MAAA,WAAA,UAAA,MAAA,EACA,CAAA,MAAA,YAAA,UAAA,OAAA,MAAA,GAAA,CACa,EAiBtDC,EAAAC,EAAA,CAAmC,CACjC,KAAA,SACQ,MAAA,oBACC,OAAA,gCACC,KAAA,YACF,WAAA,YACM,OAAA,EACJ,KAAAC,EAAA,CACI,EACd,CACA,KAAA,SACQ,MAAA,oBACC,OAAA,gCACC,KAAA,YACF,WAAA,YACM,OAAA,EACJ,KAAAA,EAAA,CACI,EACd,CACA,KAAA,SACQ,MAAA,oBACC,OAAA,gCACC,KAAA,YACF,WAAA,YACM,OAAA,EACJ,KAAAA,EAAA,CACI,EACd,CACA,KAAA,SACQ,MAAA,oBACC,OAAA,gCACC,KAAA,YACF,WAAA,YACM,OAAA,EACJ,KAAAA,EAAA,CACI,CACd,CAAA,EAGF,SAAAC,GAAA,CACEC,EAAA,MAAA,GACAC,EAAA,OAAA,EAAc,CAGhB,MAAAD,EAAAE,EAAA,EAAA,EAEAC,EAAAC,IACEA,IACEA,EAAA,CAAA,OAAA,KAEFA,EAAA,KAAA,OACAA,EAAA,MAAA,OACAA,EAAA,OAAA,OACAA,EAAA,SAAA,GACAA,EAAA,WAAA,OACAA,EAAA,KAAA,OACAA,EAAA,OAAA,EACAA,EAAA,KAAAN,IACAM,GAGFC,EAAA,CAAAC,EAAAC,IAAA,CACE,GAAA,CAAAA,EACE,OAAAD,EAEF,OAAA,KAAAA,CAAA,EAAA,QAAAE,GAAAF,EAAAE,CAAA,EAAAD,EAAAC,CAAA,CAAA,CAAgE,EAGlEP,EAAAJ,EAAAM,EAAA,CAAA,EAEA,SAAAM,GAAA,CACE,OAAAN,EAAAF,CAAA,CAAqB,CAGvB,SAAAS,GAAA,CACEV,EAAA,MAAA,GACAS,GAAM,CAGR,MAAAE,EAAAT,IAEAU,EAAAV,EAAA,EAAA,EAEA,eAAAW,EAAAC,EAAAV,EAAA,CACE,MAAAW,GAAAD,CAAA,EAAA,KAAAE,GAAA,CACEZ,EAAA,OAAAY,CAAgB,CAAA,CACjB,CAGH,SAAAC,GAAA,OACEL,EAAA,MAAA,IACAM,EAAAP,EAAA,QAAA,MAAAO,EAAA,iBAAA,KAAAF,GAAA,SAGIA,EAAA,YAAAE,EAAAF,GAAA,YAAAA,EAAA,WAAA,YAAAE,EAAA,GACAF,EAAA,MAAAG,EAAAH,GAAA,YAAAA,EAAA,WAAA,YAAAG,EAAA,GACAlB,EAAA,OACEL,EAAA,KAAA,CAAA,GAAAoB,CAAA,CAAA,EAEAX,EAAAe,EAAA,MAAAJ,CAAA,EAEFhB,EAAA,MAAA,GACAS,GAAM,GAAA,MAAA,GAAA,CAGN,QAAA,MAAA,CAAA,CAAe,GAAA,QAAA,IAAA,CAGfG,EAAA,MAAA,EAAoB,EACrB,CAGL,MAAAQ,EAAAlB,IAMA,SAAAmB,EAAAC,EAAA,CACEF,EAAA,MAAAE,EACAjB,EAAAJ,EAAAqB,CAAA,EACArB,EAAA,SAAA,CAAAA,EAAA,WAAAA,EAAA,IAAA,EACAD,EAAA,MAAA,EAAkB,CAKpB,MAAAuB,EAAA,CAAmB,EAAA,UACd,EAAA,QACA"}